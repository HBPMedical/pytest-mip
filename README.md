# `pytest-mip`: Pytest and Selenium -based integration testing and reporting of the up-and-running MIP federations

[![MIP Federation Integration Tests Pipeline](https://github.com/HBPMedical/pytest-mip/actions/workflows/build-test-report.yml/badge.svg)](https://github.com/HBPMedical/pytest-mip/actions/workflows/build-test-report.yml)

This open-source project is developed for testing and reporting the status of the up-and-running federations of the MIP.

It provides integration tests, written in Python, based on `selenium`, `pytest`, and `pytest-html`, and encapsulated in a Docker software container image for easy deployment.

The process of building the container image, running the tests, generating and deploying the report is fully automated through a [GitHub Action workflow](.github/workflows/build-test-report.yml) that is run periodically at 6:55am every day. Updated overall status of the tests is indicated by the badge above.

The report, deployed as a Github Page website can be viewed @ https://hbpmedical.github.io/pytest-mip/.


## How to run `pytest-mip` locally

### Installation instructions

#### Prerequisites

This tool is intended to be run using its Docker image and so Docker is required to be installed.

#### How to build the Docker image

1. Clone the repository

2. Go to the clone directory

3. Edit the `project_parameters.py.template` and set the variables `UserID` and `UserPWD` with your own EBRAIN credentials for login to the different MIP federations.

4. Rename `project_parameters.py.template` to `project_parameters.py`

5. Build the Docker image with the following command:

    ```bash
    $ docker build -t pytest_mip .
    ```

### How to run the tests using the Docker image

#### Test all MIP federations

Once `pytest_mip` is built, you can execute the tests for all federations as follows:

   ```bash
   $ docker run (-v /local/path/to/report:/app/report) -t pytest_mip .
   ```

   where `-v /local/path/to/report:/app/report` can be used to make the pytest-html report generated by the tests available outside the container in your `/local/path/to/report` folder.
   
   Once done, you can check the generated report by (1) going to the `/local/path/to/report` folder, and (2) opening the `Ã¬ndex.html` file in your favorite browser. 

#### Test a specific MIP federation

You can run the following command to test a specific federation:

   ```bash
   $ docker run (-v /local/path/to/report:/app/report) -t pytest_mip test_<fed_name>.py
   ```

   where `<fed_name>` designs a specific federation. Note that a report can similarly be generated in your folder of wish (such as `/local/path/to/report`) by using the `-v /local/path/to/report:/app/report` option in the docker run command.

Here is a list of `<fed_name>` / filename pairs for the different federations that are now available:
* `qa_federation` : `test_qa_federation.py`
* `public_mip` : `test_public_mip.py`
* ...
